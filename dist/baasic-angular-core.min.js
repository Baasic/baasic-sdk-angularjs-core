!function(e){var t=e.module("baasic.api",["HALParser"]);t.config(["$provide",function(t){function r(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(!("withCredentials"in new XMLHttpRequest)||window.ActiveXObject||"ActiveXObject"in window)&&t.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(t,n,a,i,o,s){function c(e,t,r){t.requestId=d;var n={proxy:e,callback:r,message:t};l[t.requestId]=n,e.sendMessage(n),d+=1}for(var u=s.all(),p=[],l={},d=0,f=0,h=u.length;h>f;f++){var g=u[f];!function(t){var n=t.get_apiUrl(),a={proxyFrame:[],apiUrlRegex:new RegExp("^"+r(n)),sendMessage:function(e){this.proxyFrame.push[e]}};p.push(a);var i=e.element('<iframe src="'+n+'proxy/angular" style="display:none"></iframe>');i.bind("load",function(){var e=a.proxyFrame;for(a.proxyFrame=this,a.sendMessage=function(e){this.proxyFrame.contentWindow.postMessage(JSON.stringify(e.message),n)};e.length>0;)a.sendMessage(e.shift())}),o.find("body").append(i)}(g)}return e.element(i).bind("message",function(e){var t=e.originalEvent||e,r=JSON.parse(t.data),n=l[r.requestId];n&&t.source==n.proxy.proxyFrame.contentWindow&&(delete l[r.requestId],n.callback(r.status,r.response,r.headersString))}),function(e,r,n,a,i,o,s,u){for(var l=0,d=p.length;d>l;l++){var f=p[l];if(f.apiUrlRegex.test(r))return void c(f,{method:e,url:r,post:n,headers:i,timeout:o,withCredentials:s,responseType:u},a)}t(e,r,n,a,i,o,s,u)}}])}]),function(e,t,r){"use strict";function n(e){return e.substr(1,e.length-2).replace(/(?:(?:\r\n)?[ \t])+/g," ")}function a(e){if(e){var t=e.match(l);if(t&&t.length>0){var a={scheme:t[0]};if(t.length>1){for(var i={},o=1,s=t.length;s>o;o++){var c=t[o].split("=");i[c[0]]=n(c[1])}a.details=i}return a}}return r}function i(e,t){return e.substring(0,t.length)===t}function o(e){var t=e.toLowerCase();return i(t,"http://")||i(t,"https://")}function s(e){return Array.prototype.slice.call(e,1)}function c(t){e.forEach(s(arguments,1),function(e){t[e]=function(r,n){return t(p(n||{},{method:e,url:r}))}})}function u(t){e.forEach(s(arguments,1),function(e){t[e]=function(r,n,a){return t(p(a||{},{method:e,url:r,data:n}))}})}var p=e.extend,l=function(){var e="(?:(?:\\r\\n)?[ \\t])+",t="(?:[\\x21\\x23-\\x27\\x2A\\x2B\\x2D\\x2E\\x30-\\x39\\x3F\\x41-\\x5A\\x5E-\\x7A\\x7C\\x7E]+)",r='"(?:[\\x00-\\x0B\\x0D-\\x21\\x23-\\x5B\\\\x5D-\\x7F]|'+e+'|\\\\[\\x00-\\x7F])*"';return RegExp(t+"(?:=(?:"+r+"|"+t+"))?","g")}(),d=function(e,t,r,n){function i(t){var r=a(t("WWW-Authenticate"));if(r&&"bearer"===r.scheme.toLowerCase()){var i=r.details;if(i&&i.error)switch(i.error){case"invalid_token":var o=n.get_accessToken();n.update_accessToken(null),e.$broadcast("token_error",{token:o,error:i.error,error_description:i.error_description})}}}var s=n.get_apiUrl(),l=function(e){if(e){e.withCredentials=!0,o(e.url)||(e.url=s+e.url);var a=e.headers||(e.headers={});a["Content-Type"]||(a["Content-Type"]="application/json; charset=UTF-8"),a.Accept||(a.Accept="application/hal+json; charset=UTF-8");var c=n.get_accessToken();c&&(a.AUTHORIZATION=c.token_type+" "+c.access_token)}var u=t(e);return u=p(u.then(function(e){if(e.headers){var t=e.headers("Content-Type");t&&-1!==t.toLowerCase().indexOf("application/hal+json")&&(e.data=r.parse(e.data)),i(e.headers)}},function(e){e.headers&&i(e.headers)}).finally(function(){var e=n.get_accessToken();e&&e.sliding_window&&(e.expireTime=(new Date).getTime()+1e3*e.sliding_window,n.update_accessToken(e))}),u)};return c(l,"get","delete","head","jsonp"),u(l,"post","put"),l};t.service("baasicApiHttp",["$rootScope","$http","HALParser","baasicApp",function(e,t,r,n){var a=new r,i=d(e,t,a,n.get());return i.createNew=function(r){return d(e,t,a,r)},i}])}(e,t),function(e,t,r){"use strict";t.service("baasicApiService",["baasicConstants",function(t){function n(t){e.isObject(t)?(e.extend(this,t),t.hasOwnProperty("orderBy")&&t.hasOwnProperty("orderDirection")&&(this.sort=t.orderBy?t.orderBy+"|"+t.orderDirection:null),t.hasOwnProperty("search")&&(this.searchQuery=t.search),t.hasOwnProperty("pageNumber")&&(this.page=t.pageNumber),t.hasOwnProperty("pageSize")&&(this.rpp=t.pageSize)):this.searchQuery=t}function a(n,a,i){e.isObject(n)?e.extend(this,n):i!==r?this[i]=n:this[t.idPropertyName]=n,a!==r&&e.isObject(a)&&e.extend(this,a)}function i(r){r.hasOwnProperty(t.modelPropertyName)?e.extend(this,r):this[t.modelPropertyName]=r}return{findParams:function(e){return new n(e)},getParams:function(e,t,r){return new a(e,t,r)},createParams:function(e){return new i(e)},updateParams:function(e){return new i(e)},removeParams:function(e){return new i(e)}}}])}(e,t),function(e,t){"use strict";t.provider("baasicApp",function(){var t,r={};this.create=function(n,a){var i={apiRootUrl:"api.baasic.com",apiVersion:"beta"},o=MonoSoftware.Baasic.Application.init(n,e.extend(i,a));return r[n]=o,t||(t=o),o},this.$get=function(){return{all:function(){var e=[];for(var t in r)e.push(r[t]);return e},get:function(e){return e?r[e]:t}}}})}(e,t),function(e,t){"use strict";t.service("baasicLookupRouteService",["baasicUriTemplateService",function(e){return{get:e.parse("lookups/{?embed,fields}"),parse:e.parse}}])}(e,t),function(e,t,r){"use strict";t.service("baasicLookupService",["baasicApiHttp","baasicApp","baasicApiService","baasicLookupRouteService",function(e,t,n,a){function i(e,t){var r={};if(e.embed){var n=e.embed.split(",");for(var a in n)t.hasOwnProperty(a)&&(r[a]=t[a])}return r}var o=t.get().get_apiKey(),s="baasic-lookup-data-"+o;return{routeService:a,get:function(t){var o=e.createHttpDefer(),c=JSON.parse(localStorage.getItem(s));return c===r||null===c?e.get(a.get.expand(n.getParams({embed:"role,accessAction,accessSection"}))).success(function(e,r,n,a){localStorage.setItem(s,JSON.stringify(e));var c=i(t,e);o.resolve({data:c,status:r,headers:n,config:a})}).error(function(e,t,r,n){o.reject({data:e,status:t,headers:r,config:n})}):o.resolve({data:i(t,c)}),o.promise},reset:function(){localStorage.setItem(s,null)}}}])}(e,t),function(e,t){"use strict";t.constant("baasicConstants",{idPropertyName:"id",modelPropertyName:"model"})}(e,t),function(e,t){"use strict";t.service("baasicUriTemplateService",[function(){return{parse:function(e){return UriTemplate.parse(e)},constructTemplateUrl:function(e,t){if(!e||!e.templateText||!e.defaultUrl)throw"Invalid template configuration.";if(e.templateText){var r=null,n=null,a=t.orderBy?t.orderBy+"|"+t.orderDirection:null,i={page:t.pageNumber,rpp:t.pageSize,sort:a,searchQuery:t.search};if(e.additionalParams)for(var o in e.additionalParams){if(i[o])throw"Property"+o+" already exists in default expand configuration";i[o]=e.additionalParams[o]}r=e.templateText.expand(i),n=r.indexOf(e.defaultUrl),url=r.substr(n)}else url=defaultUrl;return url}}}])}(e,t)}(angular);