!function(e){var r=e.module("baasic.baasicApi",["HALParser"]);r.config(["$provide",function(r){function t(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(!("withCredentials"in new XMLHttpRequest)||window.ActiveXObject||"ActiveXObject"in window)&&r.decorator("$httpBackend",["$delegate","$q","$rootScope","$window","$document","baasicApp",function(r,n,a,i,o,s){function c(e,r,t){r.requestId=l;var n={proxy:e,callback:t,message:r};d[r.requestId]=n,e.sendMessage(n),l+=1}for(var u=s.all(),p=[],d={},l=0,f=0,h=u.length;h>f;f++){var g=u[f];!function(r){var n=r.get_apiUrl(),a={proxyFrame:[],apiUrlRegex:new RegExp("^"+t(n)),sendMessage:function(e){this.proxyFrame.push[e]}};p.push(a);var i=e.element('<iframe src="'+n+'proxy/angular" style="display:none"></iframe>');i.bind("load",function(){var e=a.proxyFrame;for(a.proxyFrame=this,a.sendMessage=function(e){this.proxyFrame.contentWindow.postMessage(JSON.stringify(e.message),n)};e.length>0;)a.sendMessage(e.shift())}),o.find("body").append(i)}(g)}return e.element(i).bind("message",function(e){var r=e.originalEvent||e,t=JSON.parse(r.data),n=d[t.requestId];n&&r.source==n.proxy.proxyFrame.contentWindow&&(delete d[t.requestId],n.callback(t.status,t.response,t.headersString))}),function(e,t,n,a,i,o,s,u){for(var d=0,l=p.length;l>d;d++){var f=p[d];if(f.apiUrlRegex.test(t))return void c(f,{method:e,url:t,post:n,headers:i,timeout:o,withCredentials:s,responseType:u},a)}r(e,t,n,a,i,o,s,u)}}])}]),function(e,r,t){"use strict";function n(e){return e.substr(1,e.length-2).replace(/(?:(?:\r\n)?[ \t])+/g," ")}function a(e){if(e){var r=e.match(d);if(r&&r.length>0){var a={scheme:r[0]};if(r.length>1){for(var i={},o=1,s=r.length;s>o;o++){var c=r[o].split("=");i[c[0]]=n(c[1])}a.details=i}return a}}return t}function i(e,r){return e.substring(0,r.length)===r}function o(e){var r=e.toLowerCase();return i(r,"http://")||i(r,"https://")}function s(e){return Array.prototype.slice.call(e,1)}function c(r){e.forEach(s(arguments,1),function(e){r[e]=function(t,n){return r(p(n||{},{method:e,url:t}))}})}function u(r){e.forEach(s(arguments,1),function(e){r[e]=function(t,n,a){return r(p(a||{},{method:e,url:t,data:n}))}})}var p=e.extend,d=function(){var e="(?:(?:\\r\\n)?[ \\t])+",r="(?:[\\x21\\x23-\\x27\\x2A\\x2B\\x2D\\x2E\\x30-\\x39\\x3F\\x41-\\x5A\\x5E-\\x7A\\x7C\\x7E]+)",t='"(?:[\\x00-\\x0B\\x0D-\\x21\\x23-\\x5B\\\\x5D-\\x7F]|'+e+'|\\\\[\\x00-\\x7F])*"';return RegExp(r+"(?:=(?:"+t+"|"+r+"))?","g")}(),l=function(e,r,t,n){function i(r){var t=a(r("WWW-Authenticate"));if(t&&"bearer"===t.scheme.toLowerCase()){var i=t.details;if(i&&i.error)switch(i.error){case"invalid_token":var o=n.get_accessToken();n.update_accessToken(null),e.$broadcast("token_error",{token:o,error:i.error,error_description:i.error_description})}}}var s=n.get_apiUrl(),d=function(e){if(e){e.withCredentials=!0,o(e.url)||(e.url=s+e.url);var a=e.headers||(e.headers={});a["Content-Type"]||(a["Content-Type"]="application/json; charset=UTF-8"),a.Accept||(a.Accept="application/hal+json; charset=UTF-8");var c=n.get_accessToken();c&&(a.AUTHORIZATION=c.token_type+" "+c.access_token)}var u=r(e);return u=p(u.then(function(e){if(e.headers){var r=e.headers("Content-Type");r&&-1!==r.toLowerCase().indexOf("application/hal+json")&&(e.data=t.parse(e.data)),i(e.headers)}},function(e){e.headers&&i(e.headers)}).finally(function(){var e=n.get_accessToken();e&&e.sliding_window&&(e.expireTime=(new Date).getTime()+1e3*e.sliding_window,n.update_accessToken(e))}),u)};return c(d,"get","delete","head","jsonp"),u(d,"post","put"),d};r.service("baasicApiHttp",["$rootScope","$http","HALParser","baasicApp",function(e,r,t,n){var a=new t,i=l(e,r,a,n.get());return i.createNew=function(t){return l(e,r,a,t)},i}])}(e,r),function(e,r,t){"use strict";r.service("baasicApiService",["baasicConstants",function(r){function n(r){e.isObject(r)?(e.extend(this,r),r.hasOwnProperty("orderBy")&&r.hasOwnProperty("orderDirection")&&(this.sort=r.orderBy?r.orderBy+"|"+r.orderDirection:null),r.hasOwnProperty("search")&&(this.searchQuery=r.search),r.hasOwnProperty("pageNumber")&&(this.page=r.pageNumber),r.hasOwnProperty("pageSize")&&(this.rpp=r.pageSize)):this.searchQuery=r}function a(n,a){e.isObject(n)?e.extend(this,n):a!==t?this[a]=n:this[r.keyPropertyName]=n}function i(t){t.hasOwnProperty(r.modelPropertyName)?e.extend(this,t):this[r.modelPropertyName]=t}return{findParams:function(e){return new n(e)},getParams:function(e,r){return new a(e,r)},createParams:function(e){return new i(e)},updateParams:function(e){return new i(e)},removeParams:function(e){return new i(e)}}}])}(e,r),r.provider("baasicApp",function(){var r,t={};this.create=function(n,a){var i={apiRootUrl:"api.baasic.com",apiVersion:"beta"},o=MonoSoftware.Baasic.Application.init(n,e.extend(i,a));return t[n]=o,r||(r=o),o},this.$get=function(){return{all:function(){var e=[];for(var r in t)e.push(t[r]);return e},get:function(e){return e?t[e]:r}}}}),function(e,r){"use strict";r.constant("baasicConstants",{idPropertyName:"id",keyPropertyName:"key",modelPropertyName:"model"})}(e,r),function(e,r){"use strict";r.service("baasicUriTemplateService",[function(){return{parse:function(e){return UriTemplate.parse(e)},constructTemplateUrl:function(e,r){if(!e||!e.templateText||!e.defaultUrl)throw"Invalid template configuration.";if(e.templateText){var t=null,n=null,a=r.orderBy?r.orderBy+"|"+r.orderDirection:null,i={page:r.pageNumber,rpp:r.pageSize,sort:a,searchQuery:r.search};if(e.additionalParams)for(var o in e.additionalParams){if(i[o])throw"Property"+o+" already exists in default expand configuration";i[o]=e.additionalParams[o]}t=e.templateText.expand(i),n=t.indexOf(e.defaultUrl),url=t.substr(n)}else url=defaultUrl;return url}}}])}(e,r)}(angular);